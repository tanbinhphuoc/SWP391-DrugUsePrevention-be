2025-07-06 19:20:26.455 +07:00 [INF] Updated ReturnUrl to: https://1e62-2405-4800-5714-6960-7cbe-7c7e-3b57-2ff.ngrok-free.app/api/vnpay/return
2025-07-06 19:20:27.307 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-06 19:20:31.304 +07:00 [INF] Hangfire SQL objects installed.
2025-07-06 19:20:33.586 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: LAPTOP-QLC4GKI0\SQLEXPRESS@DrugUsePreventionDB'
2025-07-06 19:20:33.587 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-06 19:20:33.589 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-06 19:20:33.698 +07:00 [INF] Server laptop-qlc4gki0:10440:9a2d6f8b successfully announced in 75.4411 ms
2025-07-06 19:20:33.707 +07:00 [INF] Server laptop-qlc4gki0:10440:9a2d6f8b is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, SqlServerHeartbeatProcess, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-06 19:20:33.943 +07:00 [INF] Server laptop-qlc4gki0:10440:9a2d6f8b all the dispatchers started
2025-07-06 19:21:46.032 +07:00 [WRN] Failed to determine the https port for redirect.
2025-07-06 19:22:12.315 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:22:12.584 +07:00 [INF] Retrieving user with ID 5
2025-07-06 19:22:12.625 +07:00 [INF] Retrieved user Manager@
2025-07-06 19:28:52.211 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:28:52.299 +07:00 [INF] Retrieving all users
2025-07-06 19:28:52.400 +07:00 [INF] Retrieved 22 users
2025-07-06 19:30:11.498 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:30:11.539 +07:00 [INF] Retrieving users by role Consultant
2025-07-06 19:30:11.567 +07:00 [INF] Retrieved 11 users for role Consultant
2025-07-06 19:30:32.218 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:30:32.231 +07:00 [INF] Retrieving users by status Active
2025-07-06 19:30:32.262 +07:00 [INF] Retrieved 21 users with status Active
2025-07-06 19:31:15.576 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:31:15.627 +07:00 [INF] Retrieving users created between "2025-06-01T00:00:00.0000000" and "2025-07-01T00:00:00.0000000"
2025-07-06 19:31:15.652 +07:00 [INF] Retrieved 20 users
2025-07-06 19:31:46.835 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:31:46.847 +07:00 [INF] Searching users with term King
2025-07-06 19:31:46.884 +07:00 [INF] Retrieved 8 users for search term King
2025-07-06 19:32:07.175 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:32:07.200 +07:00 [INF] Getting user count by role Consultant
2025-07-06 19:32:07.286 +07:00 [INF] User count for role Consultant is 11
2025-07-06 19:32:18.527 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:32:18.533 +07:00 [INF] Getting user count by role Member
2025-07-06 19:32:18.548 +07:00 [INF] User count for role Member is 6
2025-07-06 19:32:23.886 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:32:23.902 +07:00 [INF] Getting user count by role Admin
2025-07-06 19:32:23.908 +07:00 [INF] User count for role Admin is 1
2025-07-06 19:32:36.402 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:32:36.432 +07:00 [INF] Getting new user count since "2025-07-01T00:00:00.0000000"
2025-07-06 19:32:36.444 +07:00 [INF] New user count since "2025-07-01T00:00:00.0000000" is 2
2025-07-06 19:32:44.454 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:32:44.471 +07:00 [INF] Getting active/inactive user ratio
2025-07-06 19:32:44.516 +07:00 [INF] Active/Inactive ratio: Active=95%, Inactive=4%
2025-07-06 19:33:01.137 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:33:01.163 +07:00 [INF] Retrieving all appointments
2025-07-06 19:33:01.170 +07:00 [INF] Retrieving all appointments
2025-07-06 19:33:01.493 +07:00 [INF] Retrieved 110 appointments
2025-07-06 19:33:01.504 +07:00 [INF] Retrieved 110 appointments
2025-07-06 19:33:12.046 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:33:12.074 +07:00 [INF] Retrieving consultants by status Active
2025-07-06 19:33:12.129 +07:00 [INF] Retrieved 7 consultants with status Active
2025-07-06 19:33:28.340 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:33:28.358 +07:00 [INF] Retrieving consultants by specialty king
2025-07-06 19:33:28.374 +07:00 [INF] Retrieved 1 consultants for specialty king
2025-07-06 19:33:41.140 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:33:41.155 +07:00 [INF] Retrieving performance stats for consultant ID 5
2025-07-06 19:33:41.214 +07:00 [INF] Retrieved performance stats for consultant 5: Count=3, Revenue=299997.00, CancellationRate=1.3513513513513513513513513500%
2025-07-06 19:33:47.889 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:33:47.913 +07:00 [INF] Retrieving performance stats for consultant ID 1
2025-07-06 19:33:47.918 +07:00 [INF] Retrieving performance stats for consultant ID 2
2025-07-06 19:33:47.924 +07:00 [INF] Retrieved performance stats for consultant 1: Count=1, Revenue=100.00, CancellationRate=0%
2025-07-06 19:33:48.072 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'DrugUsePreventionAPI.Controllers.Data.ApplicationDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-07-06 19:33:48.398 +07:00 [INF] Retrieving performance stats for consultant ID 5
2025-07-06 19:33:48.401 +07:00 [INF] Retrieving performance stats for consultant ID 6
2025-07-06 19:33:48.405 +07:00 [INF] Retrieved performance stats for consultant 5: Count=3, Revenue=299997.00, CancellationRate=1.3513513513513513513513513500%
2025-07-06 19:33:48.405 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'DrugUsePreventionAPI.Controllers.Data.ApplicationDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-07-06 19:33:48.475 +07:00 [INF] Retrieving performance stats for consultant ID 7
2025-07-06 19:33:48.478 +07:00 [INF] Retrieving performance stats for consultant ID 8
2025-07-06 19:33:48.480 +07:00 [INF] Retrieved performance stats for consultant 7: Count=0, Revenue=0.00, CancellationRate=0%
2025-07-06 19:33:48.482 +07:00 [INF] Retrieving performance stats for consultant ID 9
2025-07-06 19:33:48.485 +07:00 [INF] Retrieved performance stats for consultant 8: Count=1, Revenue=77777.00, CancellationRate=0%
2025-07-06 19:33:48.501 +07:00 [INF] Retrieved performance stats for consultant 9: Count=0, Revenue=0.00, CancellationRate=0%
2025-07-06 19:33:48.561 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.ConsultantRepository.GetConsultationCountAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\ConsultantRepository .cs:line 85
   at DrugUsePreventionAPI.Services.Implementations.ConsultantService.GetConsultantPerformanceStatsAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\ConsultantService .cs:line 398
   at DrugUsePreventionAPI.Controllers.AdminController.<GetAllConsultantsPerformanceStats>b__28_0(Consultant c) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 338
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllConsultantsPerformanceStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 336
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-07-06 19:33:48.650 +07:00 [ERR] Error occurred: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913., StackTrace:    at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.ConsultantRepository.GetConsultationCountAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\ConsultantRepository .cs:line 85
   at DrugUsePreventionAPI.Services.Implementations.ConsultantService.GetConsultantPerformanceStatsAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\ConsultantService .cs:line 398
   at DrugUsePreventionAPI.Controllers.AdminController.<GetAllConsultantsPerformanceStats>b__28_0(Consultant c) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 338
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllConsultantsPerformanceStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 336
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.ConsultantRepository.GetConsultationCountAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\ConsultantRepository .cs:line 85
   at DrugUsePreventionAPI.Services.Implementations.ConsultantService.GetConsultantPerformanceStatsAsync(Int32 consultantId) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\ConsultantService .cs:line 398
   at DrugUsePreventionAPI.Controllers.AdminController.<GetAllConsultantsPerformanceStats>b__28_0(Consultant c) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 338
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllConsultantsPerformanceStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 336
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-07-06 19:34:05.058 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:34:05.079 +07:00 [INF] Getting user count by role Guest
2025-07-06 19:34:05.083 +07:00 [INF] Getting user count by role Member
2025-07-06 19:34:05.085 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'DrugUsePreventionAPI.Controllers.Data.ApplicationDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-07-06 19:34:05.087 +07:00 [INF] User count for role Guest is 0
2025-07-06 19:34:05.180 +07:00 [INF] Getting user count by role Staff
2025-07-06 19:34:05.183 +07:00 [INF] Getting user count by role Consultant
2025-07-06 19:34:05.183 +07:00 [INF] User count for role Staff is 2
2025-07-06 19:34:05.189 +07:00 [INF] Getting user count by role Manager
2025-07-06 19:34:05.190 +07:00 [INF] User count for role Consultant is 11
2025-07-06 19:34:05.194 +07:00 [INF] Getting user count by role Admin
2025-07-06 19:34:05.194 +07:00 [INF] User count for role Manager is 2
2025-07-06 19:34:05.198 +07:00 [INF] User count for role Admin is 1
2025-07-06 19:34:05.237 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.UserRepository.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\UserRepository .cs:line 93
   at DrugUsePreventionAPI.Services.Implementations.UserService.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\UserService.cs:line 184
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllUserStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 303
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-07-06 19:34:05.254 +07:00 [ERR] Error occurred: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913., StackTrace:    at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.UserRepository.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\UserRepository .cs:line 93
   at DrugUsePreventionAPI.Services.Implementations.UserService.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\UserService.cs:line 184
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllUserStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 303
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.UserRepository.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\UserRepository .cs:line 93
   at DrugUsePreventionAPI.Services.Implementations.UserService.GetUserCountByRoleAsync(String roleName) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\UserService.cs:line 184
   at DrugUsePreventionAPI.Controllers.AdminController.GetAllUserStats() in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AdminController.cs:line 303
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
2025-07-06 19:34:16.822 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:34:23.106 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:34:47.413 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:34:47.448 +07:00 [INF] Retrieving payment statistics from "2025-06-07T00:00:00.0000000" to "2025-06-30T00:00:00.0000000"
2025-07-06 19:34:47.479 +07:00 [INF] Retrieved payment statistics: Total=106, Successful=32, Pending=74, AmountPaid=3200068.00
2025-07-06 19:36:48.111 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 19:37:18.288 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751804507, exp: 1751890906, iat: 1751804507, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 20:04:40.381 +07:00 [INF] Updated ReturnUrl to: https://1e62-2405-4800-5714-6960-7cbe-7c7e-3b57-2ff.ngrok-free.app/api/vnpay/return
2025-07-06 20:04:41.294 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-06 20:04:43.273 +07:00 [INF] Hangfire SQL objects installed.
2025-07-06 20:04:45.737 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: LAPTOP-QLC4GKI0\SQLEXPRESS@DrugUsePreventionDB'
2025-07-06 20:04:45.740 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-06 20:04:45.742 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-06 20:04:46.061 +07:00 [INF] Server laptop-qlc4gki0:47004:5efc6d21 successfully announced in 214.8301 ms
2025-07-06 20:04:46.081 +07:00 [INF] Server laptop-qlc4gki0:47004:5efc6d21 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, SqlServerHeartbeatProcess, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-06 20:04:46.128 +07:00 [INF] 1 servers were removed due to timeout
2025-07-06 20:04:46.282 +07:00 [INF] Server laptop-qlc4gki0:47004:5efc6d21 all the dispatchers started
2025-07-06 20:06:05.429 +07:00 [WRN] Failed to determine the https port for redirect.
2025-07-06 20:06:05.901 +07:00 [WRN] JWT Challenge: null, null, User Authenticated: false, Roles: None, Claims: None
2025-07-06 20:06:57.736 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751807199, exp: 1751893599, iat: 1751807199, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 20:06:58.065 +07:00 [INF] Toggling status for user ID 3 to Inactive
2025-07-06 20:06:58.238 +07:00 [INF] Toggled status for user consultant1 to Inactive
2025-07-06 20:07:39.954 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751807199, exp: 1751893599, iat: 1751807199, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-07-06 20:07:40.016 +07:00 [INF] Retrieving performance stats for consultant ID 1
2025-07-06 20:07:40.119 +07:00 [INF] Retrieved performance stats for consultant 1: Count=1, Revenue=100.00, CancellationRate=0%
2025-07-06 20:07:40.132 +07:00 [INF] Retrieving performance stats for consultant ID 2
2025-07-06 20:07:40.145 +07:00 [INF] Retrieved performance stats for consultant 2: Count=0, Revenue=0.00, CancellationRate=0%
2025-07-06 20:07:40.149 +07:00 [INF] Retrieving performance stats for consultant ID 5
2025-07-06 20:07:40.157 +07:00 [INF] Retrieved performance stats for consultant 5: Count=3, Revenue=299997.00, CancellationRate=1.3513513513513513513513513500%
2025-07-06 20:07:40.175 +07:00 [INF] Retrieving performance stats for consultant ID 6
2025-07-06 20:07:40.182 +07:00 [INF] Retrieved performance stats for consultant 6: Count=0, Revenue=0.00, CancellationRate=0%
2025-07-06 20:07:40.185 +07:00 [INF] Retrieving performance stats for consultant ID 7
2025-07-06 20:07:40.190 +07:00 [INF] Retrieved performance stats for consultant 7: Count=0, Revenue=0.00, CancellationRate=0%
2025-07-06 20:07:40.194 +07:00 [INF] Retrieving performance stats for consultant ID 8
2025-07-06 20:07:40.202 +07:00 [INF] Retrieved performance stats for consultant 8: Count=1, Revenue=77777.00, CancellationRate=0%
2025-07-06 20:07:40.205 +07:00 [INF] Retrieving performance stats for consultant ID 9
2025-07-06 20:07:40.211 +07:00 [INF] Retrieved performance stats for consultant 9: Count=0, Revenue=0.00, CancellationRate=0%
