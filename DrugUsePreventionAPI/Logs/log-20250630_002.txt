2025-06-30 22:16:04.136 +07:00 [INF] Updated ReturnUrl to: https://d057-115-73-230-106.ngrok-free.app/api/vnpay/return
2025-06-30 22:16:14.097 +07:00 [INF] Start installing Hangfire SQL objects...
2025-06-30 22:16:41.029 +07:00 [INF] Hangfire SQL objects installed.
2025-06-30 22:16:47.411 +07:00 [WRN] No store type was specified for the decimal property 'Price' on entity type 'Course'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-06-30 22:16:55.493 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: LAPTOP-QLC4GKI0\SQLEXPRESS@DrugUsePreventionDB'
2025-06-30 22:16:55.518 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-06-30 22:16:55.558 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-06-30 22:16:56.021 +07:00 [INF] Server laptop-qlc4gki0:48660:d87bff83 successfully announced in 316.3238 ms
2025-06-30 22:16:56.090 +07:00 [INF] Server laptop-qlc4gki0:48660:d87bff83 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, SqlServerHeartbeatProcess, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-06-30 22:16:56.948 +07:00 [INF] Server laptop-qlc4gki0:48660:d87bff83 all the dispatchers started
2025-06-30 22:17:14.838 +07:00 [INF] Generated schedules from "2025-06-30T00:00:00.0000000Z" to "2025-07-07T00:00:00.0000000Z" for all consultants
2025-06-30 22:17:47.183 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-30 22:22:54.665 +07:00 [INF] JWT Token validated successfully for user: admin, Roles: Admin, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 1, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: admin, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: admin@example.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Admin, nbf: 1751296671, exp: 1751383071, iat: 1751296671, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:22:55.348 +07:00 [ERR] Failed executing DbCommand (86ms) [Parameters=[@__assessmentDto_AssessmentType_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[AssessmentID], [a].[AssessmentName], [a].[AssessmentStage], [a].[AssessmentType], [a].[Description], [a].[IsDeleted], [a].[MaxAge], [a].[MinAge]
FROM [Assessments] AS [a]
WHERE [a].[IsDeleted] = CAST(0 AS bit) AND [a].[AssessmentStage] = N'Input' AND [a].[AssessmentType] = @__assessmentDto_AssessmentType_0
2025-06-30 22:22:55.505 +07:00 [ERR] An exception occurred while iterating over the results of a query for context type 'DrugUsePreventionAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AssessmentStage'.
Invalid column name 'AssessmentStage'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a750cff4-3b63-4255-911e-56d4e7bdafb1
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AssessmentStage'.
Invalid column name 'AssessmentStage'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:a750cff4-3b63-4255-911e-56d4e7bdafb1
Error Number:207,State:1,Class:16
2025-06-30 22:22:56.052 +07:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AssessmentStage'.
Invalid column name 'AssessmentStage'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.GenericRepository`1.FindAsync(Expression`1 predicate) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\GenericRepository .cs:line 32
   at DrugUsePreventionAPI.Services.Implementations.AssessmentService.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\AssessmentService.cs:line 57
   at DrugUsePreventionAPI.Controllers.AssessmentController.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AssessmentController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:a750cff4-3b63-4255-911e-56d4e7bdafb1
Error Number:207,State:1,Class:16
2025-06-30 22:22:56.223 +07:00 [ERR] Error occurred: Invalid column name 'AssessmentStage'.
Invalid column name 'AssessmentStage'., StackTrace:    at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.GenericRepository`1.FindAsync(Expression`1 predicate) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\GenericRepository .cs:line 32
   at DrugUsePreventionAPI.Services.Implementations.AssessmentService.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\AssessmentService.cs:line 57
   at DrugUsePreventionAPI.Controllers.AssessmentController.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AssessmentController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'AssessmentStage'.
Invalid column name 'AssessmentStage'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at DrugUsePreventionAPI.Repositories.GenericRepository`1.FindAsync(Expression`1 predicate) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Repositories\GenericRepository .cs:line 32
   at DrugUsePreventionAPI.Services.Implementations.AssessmentService.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Services\Implementations\AssessmentService.cs:line 57
   at DrugUsePreventionAPI.Controllers.AssessmentController.CreateAssessment(CreateAssessmentDto assessmentDto) in C:\SWP391\DrugUsePreventionAPI\DrugUsePreventionAPI\Controllers\AssessmentController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.ExceptionHandlerMiddlewareImpl.<Invoke>g__Awaited|10_0(ExceptionHandlerMiddlewareImpl middleware, HttpContext context, Task task)
ClientConnectionId:a750cff4-3b63-4255-911e-56d4e7bdafb1
Error Number:207,State:1,Class:16
2025-06-30 22:34:16.968 +07:00 [INF] Updated ReturnUrl to: https://d057-115-73-230-106.ngrok-free.app/api/vnpay/return
2025-06-30 22:34:18.619 +07:00 [INF] Start installing Hangfire SQL objects...
2025-06-30 22:34:23.808 +07:00 [INF] Hangfire SQL objects installed.
2025-06-30 22:34:25.294 +07:00 [WRN] No store type was specified for the decimal property 'Price' on entity type 'Course'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values in 'OnModelCreating' using 'HasColumnType', specify precision and scale using 'HasPrecision', or configure a value converter using 'HasConversion'.
2025-06-30 22:34:26.593 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: LAPTOP-QLC4GKI0\SQLEXPRESS@DrugUsePreventionDB'
2025-06-30 22:34:26.596 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-06-30 22:34:26.598 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-06-30 22:34:26.917 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 successfully announced in 279.4429 ms
2025-06-30 22:34:26.967 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, SqlServerHeartbeatProcess, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-06-30 22:34:27.018 +07:00 [INF] 1 servers were removed due to timeout
2025-06-30 22:34:27.403 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 all the dispatchers started
2025-06-30 22:34:45.697 +07:00 [WRN] Failed to determine the https port for redirect.
2025-06-30 22:35:12.588 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297688, exp: 1751384088, iat: 1751297688, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:35:12.946 +07:00 [INF] Retrieving available consultants
2025-06-30 22:35:13.238 +07:00 [INF] Retrieved 5 available consultants
2025-06-30 22:37:35.230 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:37:35.589 +07:00 [INF] Retrieving available consultants
2025-06-30 22:37:37.616 +07:00 [INF] Retrieved 5 available consultants
2025-06-30 22:37:37.686 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:37:37.731 +07:00 [INF] Retrieving available consultants
2025-06-30 22:37:37.785 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:37:38.022 +07:00 [INF] Retrieved 5 available consultants
2025-06-30 22:37:38.437 +07:00 [INF] Retrieving schedules for consultant 6 from "2025-06-30T00:00:00.0000000" to "2025-06-30T00:00:00.0000000"
2025-06-30 22:37:40.697 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:38:43.647 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:38:43.834 +07:00 [INF] Retrieving available consultants
2025-06-30 22:38:44.074 +07:00 [INF] Retrieved 5 available consultants
2025-06-30 22:38:44.133 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:38:44.138 +07:00 [INF] Retrieving available consultants
2025-06-30 22:38:44.169 +07:00 [INF] Retrieved 5 available consultants
2025-06-30 22:38:44.169 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:38:44.250 +07:00 [INF] Retrieving schedules for consultant 6 from "2025-06-30T00:00:00.0000000" to "2025-06-30T00:00:00.0000000"
2025-06-30 22:38:44.488 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:39:39.099 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297688, exp: 1751384088, iat: 1751297688, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:39:39.145 +07:00 [INF] Retrieving schedules for consultant 5 from "2025-07-02T00:00:00.0000000" to "2025-07-02T00:00:00.0000000"
2025-06-30 22:39:39.388 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:49:15.930 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:49:16.150 +07:00 [INF] Retrieving schedules for consultant 1 from "2025-06-30T00:00:00.0000000" to "2025-06-30T00:00:00.0000000"
2025-06-30 22:49:16.492 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:49:17.561 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:49:17.580 +07:00 [INF] Retrieving schedules for consultant 5 from "2025-06-30T00:00:00.0000000" to "2025-06-30T00:00:00.0000000"
2025-06-30 22:49:17.633 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:49:46.169 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:49:46.174 +07:00 [INF] Retrieving schedules for consultant 5 from "2025-07-01T00:00:00.0000000" to "2025-07-01T00:00:00.0000000"
2025-06-30 22:49:46.227 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:49:49.863 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:49:49.876 +07:00 [INF] Retrieving schedules for consultant 5 from "2025-07-02T00:00:00.0000000" to "2025-07-02T00:00:00.0000000"
2025-06-30 22:49:49.918 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:50:04.346 +07:00 [INF] JWT Token validated successfully for user: Hoang, Roles: Member, Claims: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier: 21, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: Hoang, http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress: 1dqhoang@gmail.com, http://schemas.microsoft.com/ws/2008/06/identity/claims/role: Member, nbf: 1751297837, exp: 1751384237, iat: 1751297837, iss: DrugUsePreventionAPI, aud: DrugUsePreventionClient
2025-06-30 22:50:04.394 +07:00 [INF] Retrieving schedules for consultant 5 from "2025-07-03T00:00:00.0000000" to "2025-07-03T00:00:00.0000000"
2025-06-30 22:50:24.411 +07:00 [WRN] Server laptop-qlc4gki0:45932:6b6b4ae2 encountered an exception while sending heartbeat
Microsoft.Data.SqlClient.SqlException (0x80131904): Connection Timeout Expired.  The timeout period elapsed during the post-login phase.  The connection could have timed out while waiting for server to complete the login process and respond; Or it could have timed out while attempting to create multiple active connections.  The duration spent while attempting to connect to this server was - [Pre-Login] initialization=18; handshake=17; [Login] initialization=1; authentication=0; [Post-Login] complete=14038; 
 ---> System.ComponentModel.Win32Exception (258): The wait operation timed out.
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Hangfire.SqlServer.SqlServerStorage.CreateAndOpenConnection() in C:\projects\hangfire-525\src\Hangfire.SqlServer\SqlServerStorage.cs:line 365
   at Hangfire.SqlServer.SqlServerStorage.UseConnection[T](DbConnection dedicatedConnection, Func`2 func) in C:\projects\hangfire-525\src\Hangfire.SqlServer\SqlServerStorage.cs:line 256
   at Hangfire.SqlServer.SqlServerStorage.UseConnection(DbConnection dedicatedConnection, Action`1 action) in C:\projects\hangfire-525\src\Hangfire.SqlServer\SqlServerStorage.cs:line 243
   at Hangfire.SqlServer.SqlServerConnection.Heartbeat(String serverId) in C:\projects\hangfire-525\src\Hangfire.SqlServer\SqlServerConnection.cs:line 507
   at Hangfire.Server.ServerHeartbeatProcess.Execute(BackgroundProcessContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Server\ServerHeartbeatProcess.cs:line 50
ClientConnectionId:54711e15-2131-403e-9a8b-f87939fef615
Error Number:-2,State:0,Class:11
2025-06-30 22:50:26.278 +07:00 [INF] Retrieved 12 schedules
2025-06-30 22:50:44.509 +07:00 [INF] Execution DelayedJobScheduler recovered from the Faulted state after 00:00:20.0890470 and is in the Running state now
2025-06-30 22:50:44.509 +07:00 [INF] Execution RecurringJobScheduler recovered from the Faulted state after 00:00:20.0889540 and is in the Running state now
2025-06-30 22:50:54.709 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 is now able to continue sending heartbeats
2025-06-30 22:57:03.298 +07:00 [WRN] Stopping the server due to DomainUnload or ProcessExit event...
2025-06-30 22:57:03.368 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 caught stopping signal...
2025-06-30 22:57:03.644 +07:00 [INF] Server laptop-qlc4gki0:45932:6b6b4ae2 caught stopped signal...
2025-06-30 22:57:03.685 +07:00 [WRN] Server laptop-qlc4gki0:45932:6b6b4ae2 caught shutdown signal...
